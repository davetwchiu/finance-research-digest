<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atlas Market Intelligence</title>
  <link rel="icon" type="image/png" href="./assets/favicon.png" />
  <style>
    :root { --bg:#0b1020; --panel:#121936; --panel2:#0f1530; --text:#e8ecff; --muted:#a7b0d6; --accent:#7aa2ff; --line:#243059; --ok:#35d08a; --err:#ff7b7b; }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#090e1d,#0c1330);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .topbar{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:40px;width:auto;border-radius:8px;background:#eaf0ff;padding:4px 8px}
    .title{font-size:22px;font-weight:700}.muted{color:var(--muted);font-size:13px}
    .grid{display:grid;gap:14px;margin-top:14px}.grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px}
    h2{margin:0 0 10px;font-size:16px} h3{margin:10px 0 8px;font-size:14px;color:var(--muted)}
    .chips{display:flex;flex-wrap:wrap;gap:8px}.chip{padding:6px 10px;border-radius:999px;border:1px solid #334074;background:var(--panel2);font-size:12px}
    .chip.routine{border-color:#2f8f6a;color:#35d08a}
    .chip.watch{border-color:#8d6f1d;color:#fbbf24}
    .chip.high{border-color:#8f3a3a;color:#ff7b7b}
    a.btn,button.btn{display:inline-block;text-decoration:none;color:#08112f;background:var(--accent);font-weight:600;padding:9px 12px;border-radius:10px;margin-right:8px;border:0;cursor:pointer}
    a.btn.ghost,button.btn.ghost{color:var(--text);background:transparent;border:1px solid #3a4c88}
    input{background:#0a1130;border:1px solid #304278;border-radius:8px;color:var(--text);padding:8px 10px;width:220px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
    .status{font-size:12px;margin-top:10px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .footer{margin-top:16px;font-size:12px;color:var(--muted)}
    @media (max-width:980px){.grid-3,.grid-2{grid-template-columns:1fr}}
  
    .site-brand{display:flex;align-items:center;margin:0 0 14px 0;padding:8px 10px;border:1px solid #2a3768;border-radius:10px;background:#101a3f}
    .site-brand img{height:30px;width:auto;object-fit:contain;border-radius:6px;background:transparent;padding:0}
    .site-brand a{color:#9bb8ff;text-decoration:none;font-size:13px;display:inline-flex;align-items:center}
  
    #themeToggle{position:fixed;right:14px;bottom:14px;z-index:9999;padding:8px 10px;border-radius:10px;border:1px solid #2a3768;background:#101a3f;color:#e8ecff;font-size:12px;cursor:pointer}
    body.light{background:#f5f7ff !important;color:#0f1b33 !important}
    body.light .card, body.light .topbar, body.light .site-brand, body.light details{background:#ffffff !important;border-color:#d6deef !important;color:#0f1b33 !important}
    body.light .muted, body.light .site-brand a{color:#4b5d85 !important}
    body.light a{color:#2f5bd3 !important}
    body.light #themeToggle{background:#ffffff;color:#0f1b33;border-color:#d6deef}
  </style>

  <!-- frontend-design v1 polish -->
  <style>
    :root{--brand:#2f5bd3;--brand2:#0f3ea8;--surface:#0f1733;--surface2:#111c3f;--text:#eaf0ff;--muted:#aab6d9;}
    .wrap{max-width:1280px !important;}
    .topbar{background:linear-gradient(180deg,var(--surface2),var(--surface));box-shadow:0 10px 30px rgba(0,0,0,.20);}
    .title{letter-spacing:.2px;font-weight:800;}
    .card{transition:transform .15s ease, box-shadow .15s ease;border-color:#2b3d77 !important;box-shadow:0 4px 16px rgba(0,0,0,.12);}
    .card:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.18);}
    .btn{background:linear-gradient(180deg,#5f87ff,var(--brand)) !important;color:#fff !important;}
    .btn.ghost{background:transparent !important;color:#d8e3ff !important;border-color:#4965b3 !important;}
    .site-brand{background:linear-gradient(180deg,#0f204f,#0f1733) !important;}
    .site-brand img{height:34px !important;}
    @media (max-width:780px){ .site-brand img{height:30px !important;} .title{font-size:20px !important;} }
  </style>

</head>
<body>
  <button id="themeToggle" aria-label="Toggle theme">Theme: AUTO</button>
  <div class="site-brand"><a href="./index.html" aria-label="Atlas Market Intelligence home"><img src="./assets/brand/logo-horizontal.png" alt="Atlas Market Intelligence"/></a></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand"><img src="./assets/brand/logo-mark.png" alt="Atlas Market Intelligence logo"/><div><div class="title">Atlas Market Intelligence</div><div class="muted">Auto-sync watchlist, breaking summary, and ticker deep-dives</div></div></div>
      <div class="muted">Last updated: 2026-02-24 07:22 (HKT)</div>
    </div>

    <div class="grid grid-3">
      <div class="card">
        <h2>Latest Report — Executive Summary</h2>
        <div id="execSummaryMacro" class="muted">Macro: loading...</div>
        <div id="execSummaryPolicy" class="muted" style="margin-top:6px">Policy: loading...</div>
        <div id="execSummaryDelta" class="muted" style="margin-top:6px">Change vs yesterday: loading...</div>
        <div class="row" style="margin-top:10px">
          <a class="btn" id="latestReportBtn" href="./reports/2026-02-24.html">Open full report</a>
        </div>
      </div>
      <div class="card">
        <h2>Breaking Alerts — Executive Summary</h2>
        <div id="frontBreakingTime" class="muted">Time: loading...</div>
        <div id="frontBreakingTitle" class="muted" style="margin-top:6px">Title: loading...</div>
        <div id="frontBreakingSummary" class="muted" style="margin-top:6px">Summary: loading...</div>
        <div class="row" style="margin-top:10px"><a class="btn ghost" href="./reports/breaking/">Open timeline</a></div>
      </div>
      <div class="card"><h2>Archive</h2><p class="muted">Daily snapshots.</p><a class="btn ghost" href="./reports/">Open archive</a></div>
      <div class="card">
        <h2>AI Industry Research — Executive Summary</h2>
        <div id="aiSummaryMarket" class="muted">Market trend: loading...</div>
        <div id="aiSummaryTech" class="muted" style="margin-top:6px">Tech/breakthrough: loading...</div>
        <div id="aiSummaryRisk" class="muted" style="margin-top:6px">Risk focus: loading...</div>
        <div class="row" style="margin-top:10px"><a class="btn ghost" id="aiResearchBtn" href="./ai-research/latest.html">Open full research notebook</a></div>
      </div>
      <div class="card">
        <h2>Defence Industry Research — Executive Summary</h2>
        <div id="defSummaryMarket" class="muted">Market trend: loading...</div>
        <div id="defSummaryTech" class="muted" style="margin-top:6px">Tech/program shift: loading...</div>
        <div id="defSummaryRisk" class="muted" style="margin-top:6px">Risk focus: loading...</div>
        <div class="row" style="margin-top:10px"><a class="btn ghost" id="defResearchBtn" href="./defence-research/latest.html">Open full research notebook</a></div>
      </div>
    </div>

    <div class="grid grid-2">
      <div class="card">
        <h2>Watchlist (Editable)</h2>
        <p class="muted">Tap any ticker to open its dedicated analysis page.</p>
        <div id="watchlistChips" class="chips"></div>
        <h3>Signal meaning</h3>
        <div class="row">
          <span class="chip" style="border-color:#2f8f6a;color:#35d08a">Green = Routine</span>
          <span class="chip" style="border-color:#8d6f1d;color:#fbbf24">Yellow = Watch</span>
          <span class="chip" style="border-color:#8f3a3a;color:#ff7b7b">Red = High alert</span>
        </div>
        <div class="row">
          <input id="tickerInput" placeholder="Add ticker (e.g. AMD)" maxlength="10" />
          <button class="btn" onclick="addTicker()">Add</button>
          <button class="btn ghost" onclick="removeTicker()">Remove</button>
          <button class="btn ghost" onclick="resetDefault()">Reset default</button>
        </div>
        <div class="row">
          <button class="btn ghost" onclick="copyList()">Copy list</button>
          <button class="btn" onclick="syncToGitHub()">Auto-sync now</button>
        </div>
        <div id="syncStatus" class="status muted">Auto-sync writes to <code>watchlist.json</code> in your GitHub repo.</div>
      </div>

      <div class="card" style="display:none" aria-hidden="true">
        <h2>Sync status</h2>
        <p class="muted">Auto-sync is already configured on your device.</p>
        <p class="muted">When you click <strong>Auto-sync now</strong>, this page updates <code>watchlist.json</code> in your report repo.</p>
        <p class="muted">If you ever need to reconfigure credentials, tell Hugo to open the advanced sync settings.</p>
      </div>
    </div>

    <div class="footer">v2.4: watchlist auto-sync, front-page executive summaries, breaking timeline auto-update, and clickable ticker deep-dives · <a href="./model/notes.html">Advanced model notes</a></div>
  </div>

<script>
const DEFAULTS=["AAPL","AVGO","BBAI","KTOS","MSFT","NVDA","ONDS","PLTR","RDW","RKLB","TSLA","TSM","UUUU","GOOG","IBM","BRK.B","LITE"];
const KEY_W='watchlist_v2'; const KEY_S='watchlist_sync_settings_v1';
let SIGNALS={};
function loadList(){try{return JSON.parse(localStorage.getItem(KEY_W))||DEFAULTS}catch{return DEFAULTS}}
function saveList(list){localStorage.setItem(KEY_W,JSON.stringify(list));render()}
function signalClass(s){
  const raw = (s && typeof s === 'object') ? (s.signal || s.value || 'watch') : (s || 'watch');
  const v=String(raw).toLowerCase();
  if(v==='routine' || v==='buy' || v==='positive') return 'routine';
  if(v==='high' || v==='risk-off' || v==='sell' || v==='negative') return 'high';
  return 'watch';
}
function render(){
  const list=loadList();
  const box=document.getElementById('watchlistChips');
  box.innerHTML='';
  list.forEach(t=>{
    const a=document.createElement('a');
    a.href = `./tickers/${encodeURIComponent(t)}.html`;
    a.style.textDecoration='none';
    const s=document.createElement('span');
    s.className='chip '+signalClass(SIGNALS[t]);
    s.title = `Open ${t} analysis • signal: ${SIGNALS[t]||'watch'}`;
    s.textContent=t;
    a.appendChild(s);
    box.appendChild(a);
  });
}
function norm(v){return v.trim().toUpperCase()}
function addTicker(){const i=document.getElementById('tickerInput');const t=norm(i.value);if(!t)return;const list=loadList();if(!list.includes(t)){list.push(t);saveList(list);}i.value='';}
function removeTicker(){const i=document.getElementById('tickerInput');const t=norm(i.value);if(!t)return;saveList(loadList().filter(x=>x!==t));i.value='';}
function resetDefault(){saveList([...DEFAULTS])}
async function copyList(){const txt=loadList().join(', ');try{await navigator.clipboard.writeText(txt);setStatus('Copied watchlist.',true)}catch{prompt('Copy list:',txt)}}
function getSettings(){
  try{
    return JSON.parse(localStorage.getItem(KEY_S))||{owner:'davetwchiu',repo:'finance-research-digest',token:''}
  }catch{
    return {owner:'davetwchiu',repo:'finance-research-digest',token:''}
  }
}
function setStatus(msg,ok){const el=document.getElementById('syncStatus');el.textContent=msg;el.className='status '+(ok?'ok':'err')}
async function ghRequest(url, opts){const s=getSettings();if(!s.token) throw new Error('Missing GitHub token');
  const r=await fetch(url,{...opts,headers:{'Authorization':'Bearer '+s.token,'Accept':'application/vnd.github+json','Content-Type':'application/json'}});
  if(!r.ok){const t=await r.text();throw new Error('GitHub API '+r.status+': '+t.slice(0,220));}
  return r.json();
}
async function syncToGitHub(){
  try{
    const s=getSettings(); if(!s.owner||!s.repo) throw new Error('Missing owner/repo settings');
    setStatus('Syncing watchlist.json to GitHub...',true);
    const path='watchlist.json';
    let sha=null;
    try{
      const cur=await ghRequest(`https://api.github.com/repos/${s.owner}/${s.repo}/contents/${path}`,{method:'GET'});
      sha=cur.sha||null;
    }catch(e){/* file may not exist yet */}
    const payload={
      message:`Update watchlist.json from toolbox`,
      content:btoa(unescape(encodeURIComponent(JSON.stringify({watchlist:loadList(),updatedAt:new Date().toISOString()},null,2)))) ,
      branch:'main'
    };
    if(sha) payload.sha=sha;
    await ghRequest(`https://api.github.com/repos/${s.owner}/${s.repo}/contents/${path}`,{method:'PUT',body:JSON.stringify(payload)});
    setStatus('Auto-sync successful. watchlist.json updated in repo.',true);
  }catch(err){
    setStatus('Sync failed: '+err.message,false);
  }
}

async function loadSignals(){
  try{
    const r = await fetch('./signals.json?ts='+Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('no signals');
    const j = await r.json();
    if (j.signals && typeof j.signals === 'object') {
      SIGNALS = j.signals;
    } else {
      SIGNALS = j || {};
    }
  }catch{
    SIGNALS = {};
  }
  render();
}

async function syncWatchlistFromRepo(){
  try{
    const r = await fetch('./watchlist.json?ts='+Date.now(), {cache:'no-store'});
    if(!r.ok) return;
    const j = await r.json();
    if(Array.isArray(j.watchlist) && j.watchlist.length){
      localStorage.setItem(KEY_W, JSON.stringify(j.watchlist));
    }
  }catch{}
}

async function loadExecSummary(){
  const m=document.getElementById('execSummaryMacro');
  const p=document.getElementById('execSummaryPolicy');
  const d=document.getElementById('execSummaryDelta');
  const b=document.getElementById('latestReportBtn');
  try{
    const r = await fetch('./summary.json?ts='+Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('no summary');
    const j = await r.json();
    const macro = j.macro || (Array.isArray(j.watchlist) ? `Market snapshot across ${j.watchlist.length} tracked names updated.` : 'No macro summary yet.');
    const policy = j.policy || 'Policy summary pending next macro-format run.';
    const delta = j.delta || (j.updated_at ? `Data refresh timestamp: ${j.updated_at}` : 'No delta summary yet.');
    m.textContent = `Macro: ${macro}`;
    p.textContent = `Policy: ${policy}`;
    d.textContent = `Change vs yesterday: ${delta}`;
    if(j.latestReportPath){ b.href = j.latestReportPath; }
  }catch{
    m.textContent = 'Macro: Summary will appear after next report run.';
    p.textContent = 'Policy: Summary will appear after next report run.';
    d.textContent = 'Change vs yesterday: Summary will appear after next report run.';
  }
}

async function loadFrontBreaking(){
  const t=document.getElementById('frontBreakingTime');
  const h=document.getElementById('frontBreakingTitle');
  const s=document.getElementById('frontBreakingSummary');
  try{
    const r = await fetch('./reports/breaking/breaking_summary.json?ts='+Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('no breaking summary');
    const j = await r.json();
    t.textContent = `Time: ${j.time || 'N/A'}`;
    h.textContent = `Title: ${j.title || 'No title'}`;
    s.textContent = `Summary: ${j.summary || 'No summary.'}`;
  }catch{
    t.textContent = 'Time: no recent breaking alert';
    h.textContent = 'Title: no recent breaking alert';
    s.textContent = 'Summary: waiting for next material event.';
  }
}

async function loadAISummary(){
  const m=document.getElementById('aiSummaryMarket');
  const t=document.getElementById('aiSummaryTech');
  const r=document.getElementById('aiSummaryRisk');
  const b=document.getElementById('aiResearchBtn');
  try{
    const res = await fetch('./ai-research/summary.json?ts='+Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('no ai summary');
    const j = await res.json();
    m.textContent = `Market trend: ${j.market || 'No summary yet.'}`;
    t.textContent = `Tech/breakthrough: ${j.tech || 'No summary yet.'}`;
    r.textContent = `Risk focus: ${j.risk || 'No summary yet.'}`;
    if(j.latestPath){ b.href = j.latestPath; }
  }catch{
    m.textContent = 'Market trend: summary will appear after first AI research run.';
    t.textContent = 'Tech/breakthrough: summary will appear after first AI research run.';
    r.textContent = 'Risk focus: summary will appear after first AI research run.';
  }
}

async function loadDefenceSummary(){
  const m=document.getElementById('defSummaryMarket');
  const t=document.getElementById('defSummaryTech');
  const r=document.getElementById('defSummaryRisk');
  const b=document.getElementById('defResearchBtn');
  try{
    const res = await fetch('./defence-research/summary.json?ts='+Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('no defence summary');
    const j = await res.json();
    m.textContent = `Market trend: ${j.market || 'No summary yet.'}`;
    t.textContent = `Tech/program shift: ${j.tech || 'No summary yet.'}`;
    r.textContent = `Risk focus: ${j.risk || 'No summary yet.'}`;
    if(j.latestPath){ b.href = j.latestPath; }
  }catch{
    m.textContent = 'Market trend: summary will appear after first Defence research run.';
    t.textContent = 'Tech/program shift: summary will appear after first Defence research run.';
    r.textContent = 'Risk focus: summary will appear after first Defence research run.';
  }
}


(async ()=>{
  await syncWatchlistFromRepo();
  await loadSignals();
  loadExecSummary();
  loadFrontBreaking();
  loadAISummary();
  loadDefenceSummary();
})();
</script>

<script>
(function(){
  const KEY='ami_theme_mode';
  function saved(){ return localStorage.getItem(KEY)||'auto'; }
  function effective(mode){ if(mode==='auto'){ return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light'; } return mode; }
  function apply(){
    const mode=saved();
    const eff=effective(mode);
    document.body.classList.toggle('light', eff==='light');
    const btn=document.getElementById('themeToggle');
    if(btn) btn.textContent='Theme: '+mode.toUpperCase();
    // Use full logo lockup variants by theme: dark banner on dark mode, transparent lockup on light mode.
    document.querySelectorAll('.site-brand img').forEach(img=>{
      const base = img.getAttribute('src') || '';
      const light = img.getAttribute('data-light') || base.replace('logo-banner-dark.png','logo-horizontal.png');
      const dark = img.getAttribute('data-dark') || base.replace('logo-horizontal.png','logo-banner-dark.png');
      img.setAttribute('data-light', light);
      img.setAttribute('data-dark', dark);
      img.src = (eff==='light') ? light : dark;
    });
  }
  function cycle(){ const cur=saved(); const next=cur==='auto'?'dark':cur==='dark'?'light':'auto'; localStorage.setItem(KEY,next); apply(); }
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener?.('change',()=>{ if(saved()==='auto') apply(); });
  const btn=document.getElementById('themeToggle'); if(btn) btn.addEventListener('click',cycle);
  apply();
})();
</script>

  <style id="atlas-visual-refresh-v2">
    body{background:radial-gradient(1200px 500px at 20% -10%, #1c2f6a 0%, #0b1020 45%) !important;}
    .topbar{border:1px solid #3a56a8 !important; box-shadow:0 12px 28px rgba(10,20,60,.35) !important;}
    .card{border:1px solid #3554a8 !important;}
    .card h2{letter-spacing:.2px;}
  </style>
</body>
</html>